"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StripeWebhookStack = void 0;
const cdk = require("aws-cdk-lib");
const lambda = require("aws-cdk-lib/aws-lambda");
const apigateway = require("aws-cdk-lib/aws-apigateway");
class StripeWebhookStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const webhook = new lambda.Function(this, "webhook-fn", {
            handler: "webhook.lambdaHandler",
            runtime: lambda.Runtime.NODEJS_14_X,
            code: lambda.Code.fromAsset("src"),
            environment: {
                TABLE_NAME: props.orders_table.tableName,
                USER_TABLE: props.inventory_table.tableName,
                REGION: cdk.Stack.of(this).region,
            },
            //   layers: [powertoolsLayer],
        });
        props.orders_table.grantWriteData(webhook);
        props.inventory_table.grantReadData(webhook);
        const stripe_api = new apigateway.RestApi(this, "webhook");
        const webhook_api = stripe_api.root.addResource("webhook");
        webhook_api.addMethod("POST", new apigateway.LambdaIntegration(webhook));
    }
}
exports.StripeWebhookStack = StripeWebhookStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaXBlLXdlYmhvb2stc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzdHJpcGUtd2ViaG9vay1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtQ0FBbUM7QUFFbkMsaURBQWlEO0FBQ2pELHlEQUF5RDtBQU96RCxNQUFhLGtCQUFtQixTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBQy9DLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBOEI7UUFDdEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEIsTUFBTSxPQUFPLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUU7WUFDdEQsT0FBTyxFQUFFLHVCQUF1QjtZQUNoQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO1lBQ25DLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7WUFDbEMsV0FBVyxFQUFFO2dCQUNYLFVBQVUsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVM7Z0JBQ3hDLFVBQVUsRUFBRSxLQUFLLENBQUMsZUFBZSxDQUFDLFNBQVM7Z0JBQzNDLE1BQU0sRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNO2FBQ2xDO1lBQ0QsK0JBQStCO1NBQ2hDLENBQUMsQ0FBQztRQUVILEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNDLEtBQUssQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTdDLE1BQU0sVUFBVSxHQUFHLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDM0QsTUFBTSxXQUFXLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDM0QsV0FBVyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxVQUFVLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUMzRSxDQUFDO0NBQ0Y7QUF0QkQsZ0RBc0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCAqIGFzIGxhbWJkYSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWxhbWJkYVwiO1xuaW1wb3J0ICogYXMgYXBpZ2F0ZXdheSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWFwaWdhdGV3YXlcIjtcbmltcG9ydCAqIGFzIGR5bmFtb2RiIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtZHluYW1vZGJcIjtcblxuaW50ZXJmYWNlIFN0cmlwZVdlYmhvb2tTdGFja1Byb3BzIGV4dGVuZHMgY2RrLlN0YWNrUHJvcHMge1xuICBvcmRlcnNfdGFibGU6IGR5bmFtb2RiLlRhYmxlO1xuICBpbnZlbnRvcnlfdGFibGU6IGR5bmFtb2RiLlRhYmxlO1xufVxuZXhwb3J0IGNsYXNzIFN0cmlwZVdlYmhvb2tTdGFjayBleHRlbmRzIGNkay5TdGFjayB7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBTdHJpcGVXZWJob29rU3RhY2tQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgIGNvbnN0IHdlYmhvb2sgPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIFwid2ViaG9vay1mblwiLCB7XG4gICAgICBoYW5kbGVyOiBcIndlYmhvb2subGFtYmRhSGFuZGxlclwiLFxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzE0X1gsXG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQoXCJzcmNcIiksXG4gICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICBUQUJMRV9OQU1FOiBwcm9wcy5vcmRlcnNfdGFibGUudGFibGVOYW1lLFxuICAgICAgICBVU0VSX1RBQkxFOiBwcm9wcy5pbnZlbnRvcnlfdGFibGUudGFibGVOYW1lLFxuICAgICAgICBSRUdJT046IGNkay5TdGFjay5vZih0aGlzKS5yZWdpb24sXG4gICAgICB9LFxuICAgICAgLy8gICBsYXllcnM6IFtwb3dlcnRvb2xzTGF5ZXJdLFxuICAgIH0pO1xuXG4gICAgcHJvcHMub3JkZXJzX3RhYmxlLmdyYW50V3JpdGVEYXRhKHdlYmhvb2spO1xuICAgIHByb3BzLmludmVudG9yeV90YWJsZS5ncmFudFJlYWREYXRhKHdlYmhvb2spO1xuXG4gICAgY29uc3Qgc3RyaXBlX2FwaSA9IG5ldyBhcGlnYXRld2F5LlJlc3RBcGkodGhpcywgXCJ3ZWJob29rXCIpO1xuICAgIGNvbnN0IHdlYmhvb2tfYXBpID0gc3RyaXBlX2FwaS5yb290LmFkZFJlc291cmNlKFwid2ViaG9va1wiKTtcbiAgICB3ZWJob29rX2FwaS5hZGRNZXRob2QoXCJQT1NUXCIsIG5ldyBhcGlnYXRld2F5LkxhbWJkYUludGVncmF0aW9uKHdlYmhvb2spKTtcbiAgfVxufVxuIl19